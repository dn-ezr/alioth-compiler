---
title: Space and Space engine
author: GodGnidoc
date: 2019/07/12
---

# 2. Chapter Two: Space and Space engine

- [2. Chapter Two: Space and Space engine](#2-chapter-two-space-and-space-engine)
  - [2.1. Concept of space](#21-concept-of-space)
    - [2.1.1. Main Spaces](#211-main-spaces)
    - [2.1.2. Sub Spaces](#212-sub-spaces)
    - [2.1.3. Extra Sub Space](#213-extra-sub-space)
  - [2.2. Concept of **source code document**](#22-concept-of-source-code-document)
  - [2.3. Concept of **module**](#23-concept-of-module)
  - [2.4. Concept of **target**](#24-concept-of-target)
  - [2.5. Concept of **package**](#25-concept-of-package)
  - [2.6. Structure of Space Engine](#26-structure-of-space-engine)
  - [2.7. Functionality of Space Engine](#27-functionality-of-space-engine)
    - [2.7.1. The interactive mode](#271-the-interactive-mode)
    - [2.7.2. The common usage](#272-the-common-usage)

## 2.1. Concept of space

The Alioth compiler is supposed to able to handle compiling resources located in distributed environment, thus we need a layer to abstract the differences between multiple data sources and provide unified data accessing interfaces.

**Space** is the only kind of container of compiling resources admitted by **Space Engine**, any access to any data source should be done by Space Engine.

Several certain kinds of spaces are defined by the concept of space to construct the structure of the abstract environment where the compiler will host compiling resources in.

### 2.1.1. Main Spaces

Main Spaces can be used to host packages, no matter where the main space is located, it has no father space.

- root
  
  The root space is used to contain configuration files and standard libraries for the alioth programming language; There is only one root space each time the compiler runs.
- work

  The work space is used to contain compiling resources would be used for the current target; There is only one work space each time the compiler runs.
- apkg

  The spaces of apkg kind are used to host packages for the Alioth programming language software development kits. SDKs installed by alioth compiler will be managed in certain path, therefor their home dir can be scaned to be apkg space.
### 2.1.2. Sub Spaces

Sub spaces are spaces those who have to be hosted by a father space which must be a main space. Each kind of sub space is unique within its father space.

- arc

  Sub-spaces used to contain static link libraries produced by the compiling target.
- bin

  Sub-spaces used to contain executable files prodced by the compiling target.
- doc

  Sub-spaces used to contain documents generated by compiler.
- inc

  Sub-spaces used to contain source code documents written by user.
- lib

  Sub-spaces used to contain dynamic link libraries produced by the compiling target.
- obj

  Sub-spaces used to contain object files generated by compiler.
- src

  Sub-spaces used to contain source code documents written by user.

### 2.1.3. Extra Sub Space

Spaces listed above are the standard abstract spaces, there maybe other spaces existing but not to be the standard abstract spaces. There is a space type named extra space which is used to represent these spaces.

## 2.2. Concept of **source code document**

Any abstract input stream who contains a correctly formatted **module signature** before any other available syntax structure is found is called source code document.

## 2.3. Concept of **module**

Modules : abstract units which are the smallest construct unit and the biggest symbol scope. Each module will be compiled into one corresponding object file every time compiler is executed.

All syntax structures of one module can be written in multiple source code documents in one package, there is no order limitation within top level syntax structures.

The relationship between modules can be dependent or combined but one can not contain another.

## 2.4. Concept of **target**

In generic saying, target means the stuff you wanna to build when you start the compiler. Target is a set of information, which is consists of the format of the final output, the architecture information of the platform you wanna to support and the name of this target.Although format of the final output was recorded in the target information set, not all kind of target will really write an output to space.

Compiler will generate a provide list to describe which modules the target provides.

## 2.5. Concept of **package**

A package for alioth is a pack of resources, who can be installed and managed by alioth compiler.

You can write configuration file to tell compiler which resource you want to pack into package and how the method they will be shared.

You can use compiler to install, pack and publish packages.

There are two important attributes for package, which are "package name" and "section name".

Packages with the same package name will be merged when installing, use section name to manage different resources each time.

Startup the compiler in resources server mode as a daemon process and run command to host a package, the resources server will send meta message to other known resources server.

Packages referenced by dependencies of modules which are written in a remote format will be installed automatically and kept updated each time compiler will use them, this transaction is controlled by `Compiler` engine but the remote communication between two compilers is done by `Space Engine`.

## 2.6. Structure of Space Engine

The Space Engine is one of the most important modules of the compiler of the Alioth programming language, it controls all data source.

To the lower layer, the space engine use several protocols to transmiss documents. To the higher layer, the space engine exposes unified application programming interfaces to access data sources.

There are two kinds of abstract objects that space engine should provide to the higher layer to manage the data sources.

- Abstract Space

  Abstract Space is used to represent a container for documents and other abstract spaces.
  Available methods on AbstractSpace as follow:
  - open
  
    Open the data connection to this abstract space.
  - enum

    Enumerate data sources in this abstract space including documents and sub-spaces.
  - close

    Close the data connection to this abstract space.
  - create

    Create a new sub-space of certain type.
- Abstract File

  The Abstract File is used to represent an object which carries some attributes and is available for reading or writting.

  There should be available methods ready for call to manage Abstract Files. Such as creating, deleting, opening, closing or doing IO operation.

## 2.7. Functionality of Space Engine

### 2.7.1. The interactive mode

Sometimes, compiler is started to complete a semantics diagnostic mission. This task is started by IDE automatically and documents edited have not been saved to disk. The compiler can give the right diagnostics informations only if compiler can read the lastest version of all documents.

In this situation, compiler must assume there is a extra provider, who might hosts some of the documents. Compiler has to ask whether the extra provider has the lastest version each time the compiler refers to certain document.

The extra provider has to be able to communicate with the compiler. Start the compiler in the `interactive` mode to let it know where to ask source code for.

~~~bash
#!/bin/bash

alioth v: zxc -- 0/1
~~~

The command above starts the alioth compiler in the semantic validation mode and tells the compiler that there is an extra provider, access all resources in the interactive mode.

### 2.7.2. The common usage

In generic saying, the `SpaceEngine` is used to abstact data sources into streams readable or writeable. The concept `DataSource` refers to any abstract unit who can provide data input or data storage.

It's complicated to consider to make the read or write stream thread-safe, because the abstract concept of stream is designed to be used by only one user.